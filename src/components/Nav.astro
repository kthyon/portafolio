---
import Icon from './Icon.astro';
import ThemeToggle from './ThemeToggle.astro';
import type { iconPaths } from './IconPaths';

/** Main menu items */
const textLinks: { label: string; href: string }[] = [
    { label: 'Home', href: '/portafolio' },
	{ label: 'Work', href: '/portafolio/work/' },
	{ label: 'About', href: '/portafolio/about/' },
];

/** Icon links to social media */
const iconLinks: { label: string; href: string; icon: keyof typeof iconPaths }[] = [
	{ label: 'WhatsApp', href: 'https://wa.me/573116253176', icon: 'whatsapp-logo' },
	{ label: 'GitHub', href: 'https://github.com/kthyon', icon: 'github-logo' },
	{ label: 'CodePen', href: 'https://codepen.io/kthyon', icon: 'codepen-logo' },
];

const isActive = (href: string) => {
    const currentPath = Astro.url.pathname;
    if (href === '/portafolio') {
        return currentPath === '/portafolio' || currentPath === '/portafolio/';
    }
    return currentPath.startsWith(href);
};
---

<nav class="relative z-50 font-brand font-medium mb-14" transition:name="nav">
	<div class="grid grid-cols-[1fr_auto_1fr] items-center gap-4 px-4 md:gap-8 md:px-20 py-8 md:py-10">
		<a href="/portafolio/" class="flex items-center gap-2 md:gap-3 text-gray-900 dark:text-white no-underline hover:opacity-90 transition-opacity" transition:name="logo">
			<Icon icon="terminal-window" color="var(--accent-regular)" size="1.5em" gradient />
			<span class="text-base md:text-lg font-semibold">Cristian Alvarado</span>
		</a>

		<ul class="hidden md:flex items-center gap-6 text-sm bg-white/30 dark:bg-gray-900/30 backdrop-blur-xl rounded-full px-[11px] py-4 border border-white/20 dark:border-gray-700/30 shadow-sm" transition:name="menu">
			{
				textLinks.map(({ label, href }) => (
					<li>
						<a
							aria-current={isActive(href) ? 'page' : undefined}
							class={`px-5 py-2 rounded-full transition-colors duration-200 ease-in-out ${
								isActive(href)
									? 'text-white bg-blue-600/90 dark:bg-blue-500/90 font-semibold hover:bg-blue-700/90 dark:hover:bg-blue-400/90'
									: 'text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-white/50 dark:hover:bg-gray-800/50'
							}`}
							href={href}
							transition:name={`nav-link-${href}`}
						>
							{label}
						</a>
					</li>
				))
			}
		</ul>

		<div class="flex items-center justify-end gap-6 md:gap-8" transition:name="nav-right">
			<div class="hidden lg:flex gap-6">
				{
					iconLinks.map(({ href, icon, label }) => (
						<a 
							href={href} 
							class="text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors duration-200 ease-in-out p-2.5 rounded-full hover:bg-white/50 dark:hover:bg-gray-800/50" 
							target="_blank" 
							rel="noopener noreferrer"
							aria-label={label}
							transition:name={`icon-${icon}`}
						>
							<Icon icon={icon} />
						</a>
					))
				}
			</div>
			<div class="theme-toggle" transition:name="theme-toggle">
				<ThemeToggle />
			</div>
		</div>
	</div>

	<!-- Mobile Menu Button -->
	<menu-button class="md:hidden">
		<template>
			<button 
                class="absolute top-4 right-4 md:top-6 md:right-6 flex items-center justify-center w-10 h-10 rounded-full text-gray-700 dark:text-gray-300 bg-white/30 dark:bg-gray-900/30 backdrop-blur-xl transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-opacity-50 border border-white/20 dark:border-gray-700/30" 
                aria-expanded="false"
                aria-label="Toggle menu"
                transition:name="mobile-menu-button"
            >
				<Icon icon="list" />
			</button>
		</template>
	</menu-button>

	<!-- Mobile Menu -->
	<div id="menu-content" hidden class="md:hidden absolute left-0 right-0 top-full bg-white/30 dark:bg-gray-900/30 backdrop-blur-xl rounded-b-lg border-t border-white/20 dark:border-gray-700/30" transition:name="mobile-menu">
		<ul class="flex flex-col gap-4 text-lg p-8 md:p-10 border-b border-white/20 dark:border-gray-700/30">
			{
				textLinks.map(({ label, href }) => (
					<li>
						<a
							aria-current={isActive(href) ? 'page' : undefined}
							class={`inline-block px-6 py-3 rounded-lg transition-all duration-200 ${
								isActive(href)
									? 'text-white bg-blue-600/90 dark:bg-blue-500/90 font-semibold shadow-md hover:bg-blue-700/90 dark:hover:bg-blue-400/90 backdrop-blur-sm'
									: 'text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-white/50 dark:hover:bg-gray-800/50'
							}`}
							href={href}
							transition:name={`mobile-nav-link-${href}`}
						>
							{label}
						</a>
					</li>
				))
			}
		</ul>
		<div class="p-8 flex flex-col items-center gap-6">
			<div class="flex gap-6">
				{
					iconLinks.map(({ href, icon, label }) => (
						<a 
							href={href} 
							class="text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors duration-200 p-3 rounded-full hover:bg-white/50 dark:hover:bg-gray-800/50" 
							target="_blank" 
							rel="noopener noreferrer"
							aria-label={label}
							transition:name={`mobile-icon-${icon}`}
						>
							<Icon icon={icon} />
						</a>
					))
				}
			</div>
		</div>
	</div>
</nav>

<script>
	class MenuButton extends HTMLElement {
		constructor() {
			super();
			this.appendChild(this.querySelector('template')!.content.cloneNode(true));
			const btn = this.querySelector('button')!;
			const menu = document.getElementById('menu-content')!;
			menu.hidden = true;

			const setExpanded = (expand: boolean) => {
				btn.setAttribute('aria-expanded', expand ? 'true' : 'false');
				menu.hidden = !expand;
			};

			btn.addEventListener('click', () => setExpanded(menu.hidden));

			const handleViewports = (e: MediaQueryList | MediaQueryListEvent) => {
				setExpanded(e.matches);
				btn.hidden = e.matches;
			};
			const mediaQueries = window.matchMedia('(min-width: 768px)');
			handleViewports(mediaQueries);
			mediaQueries.addEventListener('change', handleViewports);
		}
	}
	customElements.define('menu-button', MenuButton);
</script>
